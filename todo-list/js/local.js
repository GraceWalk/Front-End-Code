let model = Model(),
    render = Render(),
    chooseItem = MenuItemFunc();

//本地数据存储
function Model() {
    //添加任务
    let addTask = function(s) {
        let taskItem = [localStorage['gracewalk_todo']];
        taskItem.push(s);
        localStorage.setItem('gracewalk_todo', taskItem);
        render.init();
    };
    //完成任务
    let completeTask = function(t) {
        let arr = [localStorage['gracewalk_completed']];
        arr.push(t);
        localStorage.setItem('gracewalk_completed', arr);
        let newArr = localStorage['gracewalk_completed'].split(',');
		$('.completed-list').prepend('<li class="task-item"><span class="task-title">' + t + '</span><i>' + (newArr.length - 1) +'</i><div class="clear"><svg width="28px" height="28.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M885.960599 229.332129 139.025868 229.332129c-13.322423 0-24.092721-10.770298-24.092721-24.092721 0-13.302981 10.770298-24.097838 24.092721-24.097838l746.93473 0c13.323447 0 24.092721 10.794857 24.092721 24.097838C910.05332 218.561831 899.284045 229.332129 885.960599 229.332129L885.960599 229.332129zM645.010875 132.956128l-265.036305 0c-13.323447 0-24.097838-10.770298-24.097838-24.097838 0-13.297864 10.774391-24.093744 24.097838-24.093744l265.036305 0c13.328563 0 24.098861 10.796904 24.098861 24.093744C669.109736 122.186853 658.340461 132.956128 645.010875 132.956128L645.010875 132.956128zM404.06729 759.409856 404.06729 349.805968c0-13.301957 10.769274-24.097838 24.092721-24.097838 13.328563 0 24.097838 10.79588 24.097838 24.097838l0 409.603889c0 13.32754-10.769274 24.097838-24.097838 24.097838C414.837588 783.507694 404.06729 772.738419 404.06729 759.409856L404.06729 759.409856zM572.728618 759.409856 572.728618 349.805968c0-13.301957 10.773368-24.097838 24.097838-24.097838 13.323447 0 24.092721 10.79588 24.092721 24.097838l0 409.603889c0 13.32754-10.769274 24.097838-24.092721 24.097838C583.501986 783.507694 572.728618 772.738419 572.728618 759.409856L572.728618 759.409856zM235.406986 301.615409c13.32447 0 24.093744 10.796904 24.093744 24.092721l0 28.528754 0 91.946109 0 385.510144c0 26.600845 21.590737 48.192605 48.190559 48.192605l409.603889 0c26.599821 0 48.190559-21.591761 48.190559-48.192605l0-385.510144 0-91.946109 0-28.528754c0-13.296841 10.769274-24.092721 24.093744-24.092721 13.32754 0 24.097838 10.796904 24.097838 24.092721l0 96.383164 0 24.091698 0 409.609005c0 39.924291-32.361035 72.285327-72.284303 72.285327L283.593452 928.077324c-39.923268 0-72.284303-32.361035-72.284303-72.285327L211.309148 490.398006l0-44.215014 0-24.091698 0-96.383164C211.309148 312.412312 222.083539 301.615409 235.406986 301.615409L235.406986 301.615409zM235.406986 301.615409" /></svg></div>');
    };
    //清理任务
    let clearTask = function(list, i) {
        let arr, listName, el;
        if (list === 'todo') {
            listName = 'gracewalk_todo';
            el = '.todo-list';
        } else if (list === 'completed') {
            listName = 'gracewalk_completed';
            el = '.completed-list';
        }
        arr = localStorage[listName].split(',');
        arr.splice(i, 1);
        localStorage.setItem(listName, arr);
        render.init(el);
    };
    return {
        addTask: addTask,
        completeTask: completeTask,
        clearTask: clearTask
    }
}

//任务加载渲染器
function Render() {
    let tasks, taskTitle, taskItemHTML='';

    let init = function(e) {
        let el = e || '.todo-list', listName, finishEl;

        if(el === '.todo-list') {
            listName = 'gracewalk_todo';
            finishEl = '<div class="finish"><svg viewBox="0 0 16 16" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><style type="text/css"><![CDATA[@font-face{font-family: ifont; src: url("//at.alicdn.com/t/font_1442373896_4754455.eot?#iefix") format("embedded-opentype"), url("//at.alicdn.com/t/font_1442373896_4754455.woff") format("woff"), url("//at.alicdn.com/t/font_1442373896_4754455.ttf") format("truetype"), url("//at.alicdn.com/t/font_1442373896_4754455.svg#ifont") format("svg");}]]></style></defs><g class="transform-group"><g transform="scale(0.015625, 0.015625)"><path d="M511.174192 67.649749c-244.689908 0-443.046558 198.358697-443.046558 443.046558 0 244.689908 198.35665 443.046558 443.046558 443.046558 244.686838 0 443.046558-198.35665 443.046558-443.046558C954.22075 266.00947 755.862054 67.649749 511.174192 67.649749zM511.174192 909.437801c-220.22061 0-398.741493-178.522929-398.741493-398.741493s178.520883-398.741493 398.741493-398.741493c220.218564 0 398.741493 178.522929 398.741493 398.741493S731.392756 909.437801 511.174192 909.437801zM708.859553 372.923478 475.452619 606.334505 357.927949 488.807788c-9.389858-9.387811-25.415856-8.580422-35.798321 1.802042-10.379395 10.377348-11.184737 26.405393-1.796926 35.793204l135.981021 135.983067c4.920056 4.916986 11.660574 7.03216 18.457374 6.442736 7.535627 0.639566 15.292288-1.917676 21.057595-7.684006L746.4548 410.518724c10.382465-10.382465 10.382465-27.212782 0-37.595246C736.074382 362.544083 719.240995 362.544083 708.859553 372.923478z"></path></g></g></svg></div>';
        } else if (el === '.completed-list') {
            listName = 'gracewalk_completed';
            finishEl = '';
        }

        $(el).html('');
        if (localStorage[listName]) {
            tasks = localStorage[listName].split(',');
            for (let i = 1; i < tasks.length; i++) {
                taskTitle = tasks[i];
                $(el).prepend('<li class="task-item"><span class="task-title">' + taskTitle + '</span><i>' + i + '</i><div class="clear"><svg width="28px" height="28.00px" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M885.960599 229.332129 139.025868 229.332129c-13.322423 0-24.092721-10.770298-24.092721-24.092721 0-13.302981 10.770298-24.097838 24.092721-24.097838l746.93473 0c13.323447 0 24.092721 10.794857 24.092721 24.097838C910.05332 218.561831 899.284045 229.332129 885.960599 229.332129L885.960599 229.332129zM645.010875 132.956128l-265.036305 0c-13.323447 0-24.097838-10.770298-24.097838-24.097838 0-13.297864 10.774391-24.093744 24.097838-24.093744l265.036305 0c13.328563 0 24.098861 10.796904 24.098861 24.093744C669.109736 122.186853 658.340461 132.956128 645.010875 132.956128L645.010875 132.956128zM404.06729 759.409856 404.06729 349.805968c0-13.301957 10.769274-24.097838 24.092721-24.097838 13.328563 0 24.097838 10.79588 24.097838 24.097838l0 409.603889c0 13.32754-10.769274 24.097838-24.097838 24.097838C414.837588 783.507694 404.06729 772.738419 404.06729 759.409856L404.06729 759.409856zM572.728618 759.409856 572.728618 349.805968c0-13.301957 10.773368-24.097838 24.097838-24.097838 13.323447 0 24.092721 10.79588 24.092721 24.097838l0 409.603889c0 13.32754-10.769274 24.097838-24.092721 24.097838C583.501986 783.507694 572.728618 772.738419 572.728618 759.409856L572.728618 759.409856zM235.406986 301.615409c13.32447 0 24.093744 10.796904 24.093744 24.092721l0 28.528754 0 91.946109 0 385.510144c0 26.600845 21.590737 48.192605 48.190559 48.192605l409.603889 0c26.599821 0 48.190559-21.591761 48.190559-48.192605l0-385.510144 0-91.946109 0-28.528754c0-13.296841 10.769274-24.092721 24.093744-24.092721 13.32754 0 24.097838 10.796904 24.097838 24.092721l0 96.383164 0 24.091698 0 409.609005c0 39.924291-32.361035 72.285327-72.284303 72.285327L283.593452 928.077324c-39.923268 0-72.284303-32.361035-72.284303-72.285327L211.309148 490.398006l0-44.215014 0-24.091698 0-96.383164C211.309148 312.412312 222.083539 301.615409 235.406986 301.615409L235.406986 301.615409zM235.406986 301.615409" /></svg></div>' + finishEl + '</li>');
            }
        }
    };
    return {
        init: init
    };
}

//换肤菜单卡片弹出
function subMenuPanel() {
    $('.menu-subCard').fadeIn();
    $('.app-menu').hide();
    $('.app-back').fadeIn();
    $('.menu-box').animate({
        left: -260
    }, 300);
}

//换肤按钮
function cgColorBtn() {
    $('.colorItem').click(function() {
        mainColor = $(this).attr('data');
        localStorage.gracewalk_color = mainColor;
        appColor();
        //颤动动效
        $('.colorBlock').removeClass('shake');
        let colorBlock = $(this).find('.colorBlock');
        colorBlock.addClass('shake');
    })
}

//换肤
function appColor() {
    let mainColor = localStorage.gracewalk_color || '#25b99a';
    $('.app-header').css('background-color', mainColor);
    $('.app-header').css('transition', '0.5s');
}

